caterwaul.module( 'mulholland.mh' ,function($) { (function( ) {var options_for=function(argv) {;
return{verbose:contains_short(argv, 'v' ) } } ,source_for=function(argv) {;
return(function(xs) {var x,x0,xi,xl,xr;
for(var xr=new xs.constructor() ,xi=0,xl=xs.length;
xi<xl;
 ++xi)x=xs[xi] ,xr.push( ( (read_file) .call( {x0:x0,xi:xi,xl:xl,xs:xs,xr:xr} ,x) ) ) ;
return xr} ) .call(this, (function(xs) {var x,x0,xi,xl,xr;
for(var xr=new xs.constructor() ,xi=0,xl=xs.length,x0;
xi<xl;
 ++xi)x=xs[xi] , ( /^-/ .test(x) ) ||xr.push(x) ;
return xr} ) .call(this,argv) ) } ,contains_short=function(argv,o) {;
return(function( ) {var pattern=new RegExp( ( '^-(?!-)\\w*' + (o) + '' ) ) ;
return( (function(xs) {var x,x0,xi,xl,xr;
for(var x=xs[0] ,xi=0,xl=xs.length,x1;
xi<xl;
 ++xi) {x=xs[xi] ;
if(x1= ( (pattern) .exec(x) ) )return x1}return false} ) .call(this,argv) ) } ) .call(this) } ,read_file=function(f) {;
return require( 'fs' ) .readFileSync(f, 'utf8' ) } ,output=function(t) {;
return process.stdout.write(t+ ';\n' , 'utf8' ) } ,defaults= {cc:output} ;
return($.merge($.mulholland, (function( ) {var mh_main=function(argv) {;
return argv.length===0||contains_short(argv, 'i' ) ?mh_repl(argv) :mh_offline(argv) } ,mh_offline=function(argv) {;
return(function( ) {var mh=$.mulholland.mh() ;
return( (function(xs) {var x,x0,xi,xl,xr;
for(var xi=0,xl=xs.length;
xi<xl;
 ++xi)x=xs[xi] , ( (mh) .call( {x0:x0,xi:xi,xl:xl,xs:xs,xr:xr} ,x) ) ;
return xs} ) .call(this,source_for(argv) ) ) } ) .call(this) } ,mh_repl=function(argv) {;
return(function( ) {var mh=$.mulholland.mh() ,evaluator=function(s,_1,_2,cc) {;
return(function( ) {try{return(mh(s, {cc:function(_) {return cc(null,_) } } ) ) }catch(e) {return(cc(e,undefined) ) } } ) .call(this) } ;
return( (function(it) {return(require( 'repl' ) .start( 'mh> ' ,undefined,evaluator) ) ,it} ) .call(this, ( (function(xs) {var x,x0,xi,xl,xr;
for(var xi=0,xl=xs.length;
xi<xl;
 ++xi)x=xs[xi] , ( (mh) .call( {x0:x0,xi:xi,xl:xl,xs:xs,xr:xr} ,x) ) ;
return xs} ) .call(this,source_for(argv) ) ) ) ) } ) .call(this) } ,mh=function() {var c=context() ;
return function(s,options) {;
return(function( ) {var cc=function(x) {;
return( ( ( (options) || (defaults) ) ) ) .cc(x) } ,evaluate=function(t) {var e=c.toplevel(t) ;
return e.resolved_data() === '=' ? (function(it) {return(cc(c.toplevel.rules.length) ) ,it} ) .call(this, (define(e) ) ) :cc(e.toString() ) } ,define=function(equation) {;
return c.toplevel= (c.toplevel) .extend( [equation] ) } ;
return( (function(xs) {var x,x0,xi,xl,xr;
for(var xi=0,xl=xs.length;
xi<xl;
 ++xi)x=xs[xi] , ( (evaluate) .call( {x0:x0,xi:xi,xl:xl,xs:xs,xr:xr} ,x) ) ;
return xs} ) .call(this,c.split(s) ) ) } ) .call(this) } } ,context=function() {;
return{parse:$.mulholland() ,split:function(s) {;
return( (this) .parse(s) ) .flatten_all( ';' ) } ,toplevel:$.mulholland.rewriter( [ ] ) } } ;
return( {mh_main:mh_main,mh_offline:mh_offline,mh_repl:mh_repl,mh:mh,context:context} ) } ) .call(this) ) ) } ) .call(this) } ) ;
